FROM apache/airflow:2.0.0-python3.8

ENV BACKEND_DIRECTORY ${AIRFLOW_HOME}/backend
ENV BACKEND_DATA_DIRECTORY ${AIRFLOW_HOME}/data
ENV BACKEND_DOWNLOAD_DIRECTORY ${BACKEND_DATA_DIRECTORY}/download
ENV BACKEND_ERROR_DIRECTORY ${BACKEND_DATA_DIRECTORY}/download_error
ENV BACKEND_GRAYSCALE_DIRECTORY ${BACKEND_DATA_DIRECTORY}/grayscale
RUN mkdir -p ${BACKEND_DOWNLOAD_DIRECTORY} ${BACKEND_ERROR_DIRECTORY} ${BACKEND_GRAYSCALE_DIRECTORY}

COPY requirements.txt ${BACKEND_DIRECTORY}/

#RUN apt-get update -y && apt-get upgrade -y && apt-get install -y libssl-dev libffi-dev
RUN pip3 install --upgrade pip && pip3 install -r ${BACKEND_DIRECTORY}/requirements.txt

COPY *.py ${BACKEND_DIRECTORY}/

ENV PYTHONPATH ${PYTHONPATH}:${BACKEND_DIRECTORY}
